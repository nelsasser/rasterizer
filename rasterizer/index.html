<html>
    <head>
        <title>Simple Rasterizer</title>
        <script src="js/rasterizer.js" type="text/javascript"></script>
    </head>
    <body>
        <canvas id="canvas" width="1000px" height="1000px"></canvas>
        <script>
            const WIDTH = 1000;
            const HEIGHT = 1000;

            //set up our basic canvas
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            //set black background for canvas
            ctx.beginPath();
            ctx.rect(0, 0, WIDTH, HEIGHT);
            ctx.fillStyle = "black";
            ctx.fill();

            //create our base triangle
            var triangle = new Triangle(new Mat1x4([1, 1, 0, 1]),
                                        new Mat1x4([0, 1, 0, 1]),
                                        new Mat1x4([1, 0, 0, 1]
                                        ));

            //create our translation matrix
            var translationMatrix = new Mat1x4([8, 8, 0, 0]);
            //translate the triangle
            triangle.translate(translationMatrix);


            console.log("Tri: " + triangle.getMatrices());
            var last = 0;
            var rotation = 0;
            var rotSpeed = .1;
            draw();

            function draw(time) {
                //get elapsed time for the frame
                if(!time) time = 0;
                var elapsedTime = (time - last) / 1000;
                last = time;

                //rotate triangle
                triangle.rotate('z', [rotation]);


                //create our projection matrix
                var projectionMatrix = Mat4x4.createProjectionMatrix('perspective', 0.1, 1.5, 90);


                //project our triangle using the projection matrix
                var projectedTriangle = new Triangle(   mult1x4by4x4(triangle.a, projectionMatrix),
                                                        mult1x4by4x4(triangle.b, projectionMatrix),
                                                        mult1x4by4x4(triangle.c, projectionMatrix)
                                                    );

                console.log("Proj: " + projectedTriangle.getMatrices());

                //get the bounding box for our projected triangle
                //this reduces the computational overhead by reducing the number of points we have to loop through
                var boundingRect = Triangle.getBoundingRect(projectedTriangle.a.matrix,
                                                            projectedTriangle.b.matrix,
                                                            projectedTriangle.c.matrix);

                //refresh the screen
                clearCanvas();

                //finally draw the triangle pixel by pixel
                rasterize(boundingRect, projectedTriangle);
                
                window.requestAnimationFrame(draw);

                //increment our rotation
                rotation += (rotSpeed * elapsedTime) % 360;
            }

            function clearCanvas() {
                ctx.beginPath();
                ctx.rect(0, 0, WIDTH, HEIGHT);
                ctx.fillStyle = "black";
                ctx.fill();
            }

            function rasterize(bound, tri) {
                for(var x = bound.points[0]; x < bound.points[2]; x++) {
                    for(var y = bound.points[1]; y < bound.points[3]; y++) {
                        if(isPointInTriangle(x, y, tri)) {
                            ctx.beginPath();
                            ctx.rect(x, y, 1, 1);
                            ctx.fillStyle = "blue";
                            ctx.fill();
                    }
                    }
                }
            }
        </script>
    </body>
</html>